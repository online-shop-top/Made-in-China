<script>
  const products = [
    {
      name: "Навушники JBL Tune 510BT",
      description: "Bluetooth, до 40 годин роботи, стильний дизайн",
      price: 1999,
      image: "https://via.placeholder.com/200x150?text=JBL+510BT"
    },
    {
      name: "Power Bank Xiaomi 10000mAh",
      description: "Швидка зарядка, 2 порти, металевий корпус",
      price: 899,
      image: "https://via.placeholder.com/200x150?text=Xiaomi+PowerBank"
    },
    {
      name: "Мишка Logitech M185",
      description: "Бездротова, USB-адаптер, до 12 місяців роботи",
      price: 499,
      image: "https://via.placeholder.com/200x150?text=Logitech+M185"
    },
    {
      name: "Колонка Xiaomi Mi Portable",
      description: "Bluetooth, 16 годин автономної роботи",
      price: 1299,
      image: "https://via.placeholder.com/200x150?text=Mi+Speaker"
    }
  ];

  function generateCatalog() {
    const catalog = document.getElementById('catalog');
    products.forEach((product, index) => {
      const card = document.createElement('div');
      card.className = 'product';
      card.innerHTML = `
        <img src="${product.image}" alt="${product.name}" onclick="viewProduct(${index})" style="cursor:pointer">
        <h3 onclick="viewProduct(${index})" style="cursor:pointer">${product.name}</h3>
        <p>${product.description}</p>
        <div class="price">₴${product.price}</div>
        <a href="#" class="btn" onclick="addToCart(${index})">Купити</a>
      `;
      catalog.appendChild(card);
    });
  }

  function updateCartIcon() {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const totalQuantity = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
    const cartCountElement = document.getElementById('cart-count');
    if (cartCountElement) {
      cartCountElement.textContent = totalQuantity;
    }
  }

  function addToCart(index) {
    const product = products[index];
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    const existingProductIndex = cart.findIndex(item => item.name === product.name);

    if (existingProductIndex !== -1) {
      cart[existingProductIndex].quantity += 1;
    } else {
      product.quantity = 1;
      cart.push(product);
    }

    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartIcon();
    showToast(`Додано: "${product.name}"`);
  }

  function viewProduct(index) {
    localStorage.setItem('selectedProduct', JSON.stringify(products[index]));
    window.location.href = "product.html";
  }

  function showToast(message) {
    const toast = document.getElementById("toast");
    toast.textContent = message;
    toast.style.display = "block";
    setTimeout(() => {
      toast.style.display = "none";
    }, 2500);
  }

  // ✅ Один правильний onload
  window.onload = function () {
    generateCatalog();
    updateCartIcon();
  };
</script>
